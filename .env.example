# RideNDine Environment Variables
# =================================
# Copy this file to .env and fill in your values
# IMPORTANT: Never commit .env to version control!

# =================================
# DATABASE CONFIGURATION
# =================================
# PostgreSQL connection for primary data storage
# Format: postgresql://[user]:[password]@[host]:[port]/[database]
DATABASE_URL=postgresql://ridendine:ridendine_dev_password@localhost:5432/ridendine_dev

# Individual database connection parameters
# Used by database pool configuration
DATABASE_HOST=localhost              # Database server hostname or IP
DATABASE_PORT=5432                   # PostgreSQL default port
DATABASE_USER=ridendine              # Database user with read/write permissions
DATABASE_PASSWORD=ridendine_dev_password  # Strong password (change in production!)
DATABASE_NAME=ridendine_dev          # Database name for this environment
DATABASE_SSL=false                   # Enable SSL for production (true)

# Connection Pool Settings (managed by database.module.ts)
# - Max connections: 50 (high concurrency support)
# - Min connections: 10 (warm pool for fast response)
# - Idle timeout: 60 seconds
# - Connection timeout: 5 seconds

# =================================
# REDIS CONFIGURATION
# =================================
# Redis for caching, sessions, and real-time pub/sub
REDIS_URL=redis://localhost:6379    # Full connection string
REDIS_HOST=localhost                 # Redis server hostname
REDIS_PORT=6379                      # Redis default port
# REDIS_PASSWORD=                    # Optional: Redis password (uncomment for production)

# =================================
# JWT AUTHENTICATION
# =================================
# JSON Web Token configuration for secure API authentication
# SECURITY: Generate strong random secrets for production
# Example: openssl rand -base64 64

JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
# Purpose: Signs access tokens
# Length: 256+ bits recommended
# Rotation: Change on security breach only

JWT_EXPIRES_IN=15m
# Access token expiration (short-lived for security)
# Format: 15m (minutes), 1h (hours), 7d (days)
# Recommended: 15m-1h for production

REFRESH_TOKEN_SECRET=your-super-secret-refresh-token-key-change-this
# Purpose: Signs refresh tokens (separate from access token)
# Must be different from JWT_SECRET
# Used for token rotation without re-authentication

REFRESH_TOKEN_EXPIRES_IN=7d
# Refresh token expiration (long-lived)
# Format: Same as JWT_EXPIRES_IN
# Recommended: 7d-30d for mobile apps

REFRESH_TOKEN_EXPIRY_MS=604800000
# Refresh token expiry in milliseconds (7 days)
# Used for database storage of token expiration
# Must match REFRESH_TOKEN_EXPIRES_IN value

# =================================
# SERVICE PORTS
# =================================
# Microservice port configuration
API_PORT=9001                        # NestJS API service (main backend)
API_HOST=0.0.0.0                     # Listen on all network interfaces
DISPATCH_PORT=9002                   # Driver dispatch service
ROUTING_PORT=9003                    # Route calculation service
REALTIME_PORT=9004                   # WebSocket real-time gateway

# =================================
# STRIPE PAYMENT INTEGRATION
# =================================
# Stripe API keys for payment processing and Connect platform
# Get keys from: https://dashboard.stripe.com/apikeys

STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
# Secret key for server-side API calls
# Test mode: sk_test_...
# Live mode: sk_live_... (production only!)
# Keep this secret and never expose to client-side code

STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key
# Publishable key for client-side Stripe.js
# Test mode: pk_test_...
# Live mode: pk_live_...
# Safe to expose in frontend code

STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
# Webhook signature secret for event verification
# Get from: Stripe Dashboard > Developers > Webhooks
# Format: whsec_...
# Used to verify webhook authenticity and prevent replay attacks

STRIPE_CONNECT_REFRESH_URL=http://localhost:3001/chef/stripe/refresh
# Redirect URL when chef exits onboarding early
# Must match URL registered in Stripe Dashboard

STRIPE_CONNECT_RETURN_URL=http://localhost:3001/chef/stripe/complete
# Redirect URL when chef completes onboarding
# Must match URL registered in Stripe Dashboard

# =================================
# EMAIL SERVICE (SendGrid)
# =================================
# SendGrid API for transactional emails
# Get API key from: https://app.sendgrid.com/settings/api_keys

SENDGRID_API_KEY=your_sendgrid_api_key
# SendGrid API key with Mail Send permissions
# Format: SG.xxxxxxxxxxxxxxxx
# Required for: email verification, password reset, order notifications

FROM_EMAIL=noreply@ridendine.com
# Sender email address (must be verified in SendGrid)
# Domain authentication recommended for deliverability
# Example: noreply@yourdomain.com

# =================================
# GEOCODING & MAPPING SERVICES
# =================================
# Multiple provider support for geocoding and routing

MAPBOX_TOKEN=your_mapbox_token
# Mapbox API token for geocoding and maps
# Get from: https://account.mapbox.com/access-tokens/
# Format: pk.ey...
# Free tier: 100,000 requests/month

GOOGLE_MAPS_API_KEY=your_google_maps_api_key
# Google Maps Platform API key
# Get from: https://console.cloud.google.com/google/maps-apis
# Required APIs: Geocoding, Distance Matrix, Maps JavaScript
# Free tier: $200 credit/month

OSRM_BASE_URL=http://router.project-osrm.org
# Open Source Routing Machine (OSRM) endpoint
# Default: Public demo server (rate limited)
# Production: Self-host OSRM server for reliability
# Docs: https://project-osrm.org/

# =================================
# FRONTEND URLs (CORS Configuration)
# =================================
# Allowed origins for Cross-Origin Resource Sharing
# Add your frontend application URLs here

CUSTOMER_WEB_URL=http://localhost:8010
# Customer web app (React)
# Production: https://app.ridendine.com

CUSTOMER_MOBILE_URL=ridendine://
# Customer mobile app deep link scheme
# Format: appname://

CHEF_DASHBOARD_URL=http://localhost:3001
# Chef dashboard (Next.js)
# Production: https://chef.ridendine.com

DRIVER_APP_URL=ridendine-driver://
# Driver mobile app deep link scheme
# Format: appname-driver://

ADMIN_PANEL_URL=http://localhost:3002
# Admin web dashboard (Next.js)
# Production: https://admin.ridendine.com

# =================================
# ENVIRONMENT
# =================================
NODE_ENV=development
# Environment mode: development | staging | production
# Affects:
# - CORS policies (development allows localhost + LAN IPs)
# - Error stack traces (shown in development only)
# - Logging verbosity
# - SSL requirements
# IMPORTANT: Set to "production" in deployed environments

# =================================
# RATE LIMITING (DDoS Protection)
# =================================
# Global rate limiting to prevent abuse
# Uses @nestjs/throttler with Redis storage

RATE_LIMIT_WINDOW_MS=900000
# Rate limit time window in milliseconds
# Default: 900000ms (15 minutes)
# Per-IP request counting window

RATE_LIMIT_MAX_REQUESTS=100
# Maximum requests per IP per window
# Default: 100 requests per 15 minutes
# Endpoint-specific limits (configured in controllers):
# - Login: 5/minute
# - Registration: 3/hour
# - Email verification: 3/5 minutes

# =================================
# FILE UPLOAD
# =================================
# Configuration for document and image uploads

MAX_FILE_SIZE_MB=10
# Maximum file size in megabytes
# Applied to chef documents, profile pictures
# Enforced by multer middleware

UPLOAD_DIRECTORY=./uploads
# Local storage directory for uploaded files
# Production: Use cloud storage (S3, GCS, Azure Blob)
# Ensure directory has write permissions
# Structure:
# - ./uploads/chef-documents/
# - ./uploads/profile-pictures/

# =================================
# LOGGING
# =================================
LOG_LEVEL=debug
# Logging verbosity level
# Options: error | warn | info | debug
# - error: Only errors
# - warn: Warnings and errors
# - info: General information + above
# - debug: Verbose output (development only)
# Production recommendation: info or warn

# =================================
# OPTIONAL: ADVANCED CONFIGURATION
# =================================

# Sentry Error Tracking (Production)
# SENTRY_DSN=https://xxxxxxx@sentry.io/xxxxxxx
# Capture and track application errors

# Bull Queue (Background Jobs)
# BULL_REDIS_HOST=localhost
# BULL_REDIS_PORT=6379
# Separate Redis instance for job queues

# Session Configuration
# SESSION_SECRET=your-session-secret
# Used if implementing session-based auth

# =================================
# SECURITY CHECKLIST (Production)
# =================================
# Before deploying to production:
# [ ] Generate strong random JWT secrets (256+ bits)
# [ ] Enable DATABASE_SSL=true
# [ ] Set NODE_ENV=production
# [ ] Use live Stripe keys (sk_live_, pk_live_)
# [ ] Configure real email sender (verified domain)
# [ ] Set up Sentry for error tracking
# [ ] Use environment-specific frontend URLs
# [ ] Enable Redis password (REDIS_PASSWORD)
# [ ] Review and adjust rate limits for your traffic
# [ ] Set up cloud storage for file uploads
# [ ] Configure database backups
# [ ] Enable SSL/TLS for all services
# [ ] Rotate secrets regularly (quarterly)
# [ ] Never commit .env file to Git!

# =================================
# TROUBLESHOOTING
# =================================
# Database connection failed?
# - Verify PostgreSQL is running: pg_isready -h localhost -p 5432
# - Check credentials match database setup
# - Ensure ridendine user and database exist
# - Run migrations: npm run db:migrate

# Redis connection failed?
# - Verify Redis is running: redis-cli ping
# - Check REDIS_HOST and REDIS_PORT
# - Test connection: redis-cli -h localhost -p 6379

# JWT errors?
# - Ensure JWT_SECRET and REFRESH_TOKEN_SECRET are different
# - Verify token expiration formats (15m, 7d, etc.)
# - Check REFRESH_TOKEN_EXPIRY_MS matches REFRESH_TOKEN_EXPIRES_IN

# CORS errors?
# - Add frontend URL to appropriate variable
# - Restart API service after .env changes
# - Check browser console for specific origin

# Rate limit errors (429)?
# - Increase RATE_LIMIT_MAX_REQUESTS if needed
# - Adjust RATE_LIMIT_WINDOW_MS for longer window
# - Review endpoint-specific limits in controllers

# =================================
# SUPPORT & DOCUMENTATION
# =================================
# Full API documentation: /home/nygmaee/Desktop/rideendine/05_api_endpoint_specs.md
# Architecture docs: /home/nygmaee/Desktop/rideendine/docs/ARCHITECTURE.md
# Development guide: /home/nygmaee/Desktop/rideendine/docs/DEVELOPMENT.md
# OpenAPI spec: http://localhost:9001/api/docs (after Swagger setup)
